#!/usr/bin/env perl

use strict;


use Tie::IxHash;


my %user;
my $user  = Tie::IxHash->new
    (

     'lnc.usc.edu'                 => 'brannon',
     'fyodor.hcoop.net'            => 'terry',

     'perlmonk.org'                => 'metaperl',
     'zandev.svr.bankone.net'      => 'w049945',
     'mire.hcoop.net'              => 'terry',
     'li2-168.members.linode.com'  => 'schemelab'
    ) ;


my @user_i = $user->Indices ($user->Keys) ;


sub ssh_string {
  my $host = shift;
  my $user = $user->FETCH($host);
  sprintf "%s@%s", $user, $host
}

sub printchoices {

  print "\n\n";
  print "ssh hosts\n";
  print "---------\n";

  for my $i (@user_i) {
      printf "[$i] %s\n" , $user->Keys($i) ;
  }
}

sub prompt {
  print "\n\nssh to: " ;
}


sub getchoice {
  prompt ;
  my $choice = <STDIN> ;
  chomp $choice;
  return $choice;
}



sub mainloop {
  {
    printchoices;
    my $c = getchoice ;
    return $c if $c =~ /^\d+$/ and $c >= 0 and $c <= $#user_i  ;
    redo;
  }
}

my $c = mainloop;
my $host = $user->Keys($c);
my $sshstr = ssh_string($host) ;

print $sshstr, "\n" ;
if ($ENV{DISPLAY}) {
    `xterm -title '$sshstr' -e 'ssh -Y $sshstr' &` ;
} else {
    exec 'ssh', '-C', '-A', '-X', $sshstr ;
}








